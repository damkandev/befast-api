<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="../style.css">

</head>

<body data-bs-theme="dark">
  <br>
  <div class="container d-flex flex-wrap align-items-center">
    <h1>Inspectores</h1>
    <table id="myTable" class="table">
      <thead>
        <tr>
          <th scope="col">id</th>
          <th scope="col">nombres</th>
          <th scope="col">apellido_p</th>
          <th scope="col">apellido_m</th>
          <th scope="col">rut</th>
          <th scope="col">telefono</th>
          <th scope="col">direccion</th>
          <th scope="col">opciones</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>

    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCrear">
      Crear Inspector
    </button>

  </div>

  <!-- Modal Crear Estudiante -->
  <div class="modal fade" id="modalCrear" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Estudiante</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Para crear un <b>Inspector</b> rellena los siguientes campos que tendras a continuación:</p>
          <form action="crear">
            <label for="nombres">Nombres (Ej: Jose Juan): </label>
            <input class="form-control" type="text" name="nombres" id="nombres">

            <label for="apellido_p">Apellido Paterno: </label>
            <input class="form-control" type="text" name="apellido_p" id="apellido_p">

            <label for="apellido_m">Apellido Materno: </label>
            <input class="form-control" type="text" name="apellido_m" id="apellido_m">

            <label for="rut">R.U.T (Ej: 123456789): </label>
            <input class="form-control" type="text" name="rut" id="rut">

            <label for="telefono">Telefono (Ej: 912345678): </label>
            <input class="form-control" type="text" name="telefono" id="telefono">

            <label for="direccion">Direccion (Ej: Jorge Andreda 300): </label>
            <input class="form-control" type="text" name="direccion" id="direccion">

            <button type="button" class="btn btn-primary" id="crearInspectorBtn">Crear Inspector</button>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Ver Estudiante -->
  <div class="modal fade" id="modalVer" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="tituloModal">Modal Title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div id="contenidoModal" class="modal-body">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Editar -->
  <div class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Juego:</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Nuevos Nombres:</label>
              <input type="text" class="form-control" id="Enombres">

              <label for="recipient-name" class="col-form-label">Nuevo Apellido Paterno:</label>
              <input type="text" class="form-control" id="Eapellido_p">

              <label for="recipient-name" class="col-form-label">Nuevo Apellido Materno:</label>
              <input type="text" class="form-control" id="Eapellido_m">

              <label for="recipient-name" class="col-form-label">Nuevo RUT:</label>
              <input type="text" class="form-control" id="Erut">

              <label for="recipient-name" class="col-form-label">Nuevo Telefono:</label>
              <input type="text" class="form-control" id="Etelefono">

              <label for="recipient-name" class="col-form-label">Nueva Dirección:</label>
              <input type="text" class="form-control" id="Edireccion">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" id="editarBtn" class="btn btn-primary">Editar</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  function updateTable() {
    $.ajax({
      url: "http://localhost:8000/api/inspectores",
      type: "GET",
      contentType: "application/json ; charset=utf8",
      dataType: "json",
      success: function (response) {
        var tabla = $('#myTable > tbody:last-child')
        tabla.empty()
        response.forEach(inspectores => {
          var id = inspectores.id;
          var nombres = inspectores.nombres;
          var apellido_p = inspectores.apellido_p;
          var apellido_m = inspectores.apellido_m;
          var rut = inspectores.rut;
          var telefono = inspectores.telefono;
          var direccion = inspectores.direccion
          var fila = '<tr class="fila">' + '<td class="id">' + id + '</td>' + '<td>' + nombres + '</td>' + '<td>' + apellido_p + '</td>' + '<td>' + apellido_m + '</td>' + '<td>' + rut + '</td>' + '<td>' + telefono + '</td>' + '<td>' + direccion + '</td>' + '<td><button class="btn btn-success btn-ver" onclick="btnVer()"><i class="fas fa-eye"></i></button> <button onclick="btnEditarModal()" class="btn btn-warning btn-editar"><i class="fas fa-edit"></i></button> <button class="btn btn-danger btn-borrar" onclick="btnBorrar()"><i class="fas fa-trash"></i></button></td>' + '<tr>'
          tabla.append(fila)
        })
      }
    })
  }

  updateTable()


  $('#crearInspectorBtn').click(() => {
    var nombres = $('#nombres').val()
    var apellido_p = $('#apellido_p').val()
    var apellido_m = $('#apellido_m').val()
    var rut = $('#rut').val()
    var telefono = $('#telefono').val()
    var direccion = $('#direccion').val()

    var datos = {
      "nombres": nombres,
      "apellido_p": apellido_p,
      "apellido_m": apellido_m,
      "rut": rut,
      "telefono": telefono,
      "direccion": direccion
    }

    $.ajax({
      url: "http://localhost:8000/api/inspector/",
      type: "POST",
      contentType: "application/json ; charset=utf8",
      data: JSON.stringify(datos),
      success: function (response) {
        updateTable()

      }
    })
  })

  function btnVer() {
    var button = event.target
    var row = button.closest('tr')
    var idElement = row.querySelector('.id')
    var id = idElement.textContent;


    $.ajax({
      url: `http://localhost:8000/api/inspector/${id}`,
      type: "GET",
      contentType: "application/json ; charset=utf8",
      dataType: "json",
      success: (response) => {
        $('#tituloModal').html(response.nombres);
        $('#contenidoModal').html(`<b>Nombres:</b>\n ${response.nombres}\n<b>Apellido Paterno:</b>\n ${response.apellido_p}\n<b>Apellido Materno:</b> \n${response.apellido_m}\n<b>RUT:</b> \n${response.rut}\n<b>Telefono:</b>\n ${response.telefono}\n<b>Dirección:</b>\n ${response.direccion}`);
        $('#modalVer').modal('show');
      }
    });
  }

  function btnEditarModal() {
    var button = event.target
    var row = button.closest('tr')
    var idElement = row.querySelector('.id')
    var id = idElement.textContent;
    $('#modalEditar').modal('show')
    $('#editarBtn').click(() => {
      console.log(id);
      var nombres = $('#Enombres').val()
      var apellido_p = $('#Eapellido_p').val()
      var apellido_m = $('#Eapellido_m').val()
      var rut = $('#Erut').val()
      var telefono = $('#Etelefono').val()
      var direccion = $('#Edireccion').val()
      var datos = {
        "id": id,
        "nombres": nombres,
        "apellido_p": apellido_p,
        "apellido_m": apellido_m,
        "rut": rut,
        "telefono": telefono,
        "direccion": direccion
      }

      $.ajax({
        url: `http://127.0.0.1:8000/api/inspector/${id}`,
        type: "PUT",
        contentType: "application/json ; charset=utf8",
        dataType: "json",
        data: JSON.stringify(datos),
        success: (response) => {
          $('#exampleModal').modal('show');
          updateTable()
        }
      });
    })
  }

  function btnBorrar() {
    var button = event.target
    var row = button.closest('tr')
    var idElement = row.querySelector('.id')
    var id = idElement.textContent;

    var datos = {
      "id": id
    }

    $.ajax({
      url: `http://127.0.0.1:8000/api/inspector/${id}`,
      type: "DELETE",
      data: JSON.stringify(datos),
      contentType: "application/json ; charset=utf8",
      dataType: "json",
      success: (response) => {
        updateTable()
      }
    });
  }
</script>


</html>